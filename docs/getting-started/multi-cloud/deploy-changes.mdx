---
title: Modify & Deploy Changes
---

Now that your Stack has been deployed. Let's add the ability to remove example documents from our database via a new delete function.

<CodeExamples 
	languages={[
	{
		label: "Node",
		value: "node"
	},
	{
		label: "Python",
		value: "python"
	},
	{
		label: "Java",
		value: "java"
	},
	{
		label: "Go",
		value: "go"
	},
	]}
	defaultLang="node"
>

<CodeExample lang="node">

## Add a new function

First, from within your `functions` directory, create a new `delete.ts` file
that contains your function code:

```typescript
// functions/delete.ts

import { faas, documents } from '@nitric/sdk';
import { Example, path } from '../common';

// Start your function here
faas
  .http(async (ctx: faas.HttpContext): Promise<faas.HttpContext> => {
    // get params from path
    const { id } = path.test(ctx.req.path);

    if (!id) {
      ctx.res.body = new TextEncoder().encode('Invalid Request');
      ctx.res.status = 400;
    }

    try {
      console.log('removing doc id', id);
      await documents().collection<Example>('examples').doc(id).delete();
      ctx.res.body = new TextEncoder().encode(`Removed example with ID: ${id}`);
    } catch (e) {
      ctx.res.status = 404;
      ctx.res.body = new TextEncoder().encode(
        `Example not found!: ${e.message}`
      );
    }

    return ctx;
  })
  .start();
```

Now to add our new `delete` function to our Stack definition and API.

## Add function handler to Stack

First, you will modify your `nitric.yaml` file to add our `delete `function handler:

```yaml
name: nitric-tutorial
# Nitric functions
functions:
  create:
    handler: functions/create.ts
  read:
    handler: functions/read.ts
  list:
    handler: functions/list.ts
  # new delete function here
  delete:
    handler: functions/delete.ts
# Nitric collections
collections:
  examples: {}
# Nitric APIs
apis:
  examples: api.yaml
```

</CodeExample>

<CodeExample lang="python">

## Add a new function

First, from within your `functions` directory, create a new `delete.py` file
that contains your function code:

```python
from nitric.api.exception import NotFoundException, NitricServiceException
from nitric.faas import start, Trigger, Response
from nitric.api import Documents


async def handler(trigger: Trigger) -> Response:
    ctx = trigger.context.as_http()
    response = trigger.default_response()

    # get id param from HTTP request path
    try:
        doc_id = ctx.path.split("/")[-1]
    except IndexError:
        response.data = "Invalid request"
        response.context.as_http().status = 400
        return response

    try:
        await Documents().collection("examples").doc(doc_id).delete()
        response.data = "Removed example " + doc_id
    except NotFoundException:
        response.context.as_http().status = 404
        response.data = "Example not found"
    except NitricServiceException:
        response.context.as_http().status = 500
        response.data = "An unexpected error occurred"

    return response

if __name__ == "__main__":
    start(handler)
```

Now to add our new `delete` function to our Stack definition and API.

## Add function handler to Stack

First, you will modify your `nitric.yaml` file to add our `delete `function handler:

```yaml
name: nitric-tutorial-py
# Nitric functions
functions:
  create:
    handler: functions/create.py
  read:
    handler: functions/read.py
  list:
    handler: functions/list.py
  # new delete function here
  delete:
    handler: functions/delete.py
# Nitric collections
collections:
  examples: {}
# Nitric APIs
apis:
  examples: api.yaml
```

</CodeExample>

<CodeExample lang="java">

## Add a new function

Let's make it easy for ourselves by copying an existing function directory as a starting point:

1. From within your `functions` directory, copy the `read` directory and paste it under the same `functions` directory, then rename the copy to `delete`.
2. Within the `pom.xml` file in your new function directory, under project replace the artifactId contents `example-read` with `example-delete`.

```xml
<artifactId>example-delete</artifactId>
```

3. Then replace the mainClass contents `com.example.service.ReadFunction` with `com.example.service.DeleteFunction`.

```xml
<mainClass>com.example.service.DeleteFunction</mainClass>
```

4. In the root `pom.xml` file, under modules add the new module:

```xml
<module>functions/delete</module>
```

5. In the `src/main/java/com/example/service` directory, rename the `ReadFunction.java` file to `DeleteFunction.java` and replace its contains with your new function code:

```java
package com.example.service;

import io.nitric.api.NitricException;
import io.nitric.api.document.Documents;
import io.nitric.faas.Faas;
import io.nitric.faas.Trigger;
import io.nitric.faas.NitricFunction;
import io.nitric.faas.Response;

public class DeleteFunction implements NitricFunction {

    final Documents documents;

    public DeleteFunction(Documents documents) {
        this.documents = documents;
    }

    @Override
    public Response handle(Trigger trigger) {
        var paths = trigger.getContext().asHttp().getPath().split("/");
        var id = paths[paths.length - 1];

        try {
            documents.collection("examples").doc(id).delete();

            var msg = String.format("Removed example with ID: %s", id);
            return trigger.buildResponse(msg);
        } catch (NitricException ne) {
            var response = trigger.buildResponse("Error removing example: " + ne.toString());
            response.getContext().asHttp().setStatus(500);
            return response;
        }
    }

    public static void main(String[] args) {
        Faas.start(new DeleteFunction(new Documents()));
    }
}
```

Now to add our new `delete` function to our Stack definition and API.

## Add function handler to Stack

First, you will modify your `nitric.yaml` file to add our `delete `function handler:

```yaml
name: example-java-service

# Nitric functions
functions:
  create:
    handler: functions/create/target/example-create-1.0.jar
  list:
    handler: functions/list/target/example-list-1.0.jar
  read:
    handler: functions/read/target/example-read-1.0.jar
  delete:
    handler: functions/delete/target/example-delete-1.0.jar

# Nitric collections
collections:
  examples: {}

# Nitric APIs
apis:
  examples: api.yaml
```

</CodeExample>

<CodeExample lang="go">

## Add a new function

First, from within your `functions` directory, create a new `delete` directory. Then create a `main.go` file that contains your function code:

```go
package main

import (
	"fmt"
	"path"

	"github.com/nitrictech/go-sdk/api/documents"
	"github.com/nitrictech/go-sdk/faas"
)

// NitricFunction - Handles individual function requests (http, events, etc.)
func NitricFunction(trigger *faas.NitricTrigger) (*faas.NitricResponse, error) {
	resp := trigger.DefaultResponse()

	id := path.Base(trigger.GetContext().AsHttp().Path)

	dc, err := documents.New()
	if err != nil {
		return nil, err
	}

	err = dc.Collection("examples").Doc(id).Delete()
	if err != nil {
		resp.SetData([]byte("Error retrieving document"))
		resp.GetContext().AsHttp().Status = 404
		return resp, nil
	}

	resp.SetData([]byte("Removed example " + id))
	resp.GetContext().AsHttp().Headers["Content-Type"] = []string{"application/json"}

	return resp, nil
}

func main() {
	if err := faas.Start(NitricFunction); err != nil {
		fmt.Println(err)
	}
}
```

Now to add our new `delete` function to our Stack definition and API.

## Add function handler to Stack

First, you will modify your `nitric.yaml` file to add our `delete `function handler:

```yaml
name: nitric-tutorial-go
# Functions
functions:
  create:
    handler: functions/create/main.go
  read:
    handler: functions/read/main.go
  list:
    handler: functions/list/main.go
  # new delete function here
  delete:
    handler: functions/delete/main.go
# Collections
collections:
  examples: {}
# APIs
apis:
  examples: api.yaml
```

</CodeExample>

</CodeExamples>

## Add operation to API

Now we can update the `api.yaml` file with a new `delete` operator:

```yaml
openapi: 3.0.0
info:
  version: 1.0.0
  title: Example API
  description: Example API
paths:
  /examples:
    get:
      operationId: examples-list
      x-nitric-target:
        name: list
        type: function
      description: Retrieve all examples
      responses:
        '200':
          description: Successful response
    post:
      operationId: examples-create
      x-nitric-target:
        name: create
        type: function
      description: Creates and persists new examples
      responses:
        '200':
          description: Successful response
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExamplesCreate'
  /examples/{exampleId}:
    get:
      operationId: examples-read
      parameters:
        - in: path
          name: exampleId
          schema:
            type: string
          required: true
      x-nitric-target:
        name: read
        type: function
      description: Retrieve an existing example by its ID
      responses:
        '200':
          description: Successful response
    # new delete operation here
    delete:
      operationId: examples-delete
      parameters:
        - in: path
          name: exampleId
          schema:
            type: string
          required: true
      x-nitric-target:
        name: delete
        type: function
      description: Remove an existing example by its ID
      responses:
        '200':
          description: Successful response
components:
  schemas:
    ExamplesCreate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
```

## Test Change Locally

Remember before deployment, you can test your new function locally with `nitric run`.

Testing the delete function with curl would look like this:

1. Insert an example, that you will delete later:

```bash
curl -H "Content-Type: application/json" -X POST -d '{"name": "first example", "description":"Take me to the moon 🚀"}' http://localhost:49152/examples
```

2. Copy the ID from the response, it will look like this:

```bash
Created example with ID: 5446a712-27d5-49b6-b8fd-9c2b0b488733
```

3. Check the example is there by retrieving it by ID:

```bash
curl http://localhost:49152/examples/5446a712-27d5-49b6-b8fd-9c2b0b488733
```

The response should be: `{"name":"first example","description":"Take me to the moon 🚀"}`

4. Delete the example using the ID copied from step 2:

```bash
curl -X DELETE http://localhost:49152/examples/5446a712-27d5-49b6-b8fd-9c2b0b488733
```

The response should be `Removed example with ID: 5446a712-27d5-49b6-b8fd-9c2b0b488733`.

## Deploy Changes

Let's see those new changes up on the cloud! Simply re-run the `deploy` command for your chosen cloud provider:

<CodeExamples 
	languages={[
	{
		icon: <img src="/img/logos/aws.svg" noMargin priority width={70} height={34} />,
		value: "aws",
	}, {
		icon: <img src="/img/logos/gcp-no-text.svg" noMargin priority width={100} height={40} />,
		value: "gcp"
	}, {
		icon: <img src="/img/logos/azure-no-text.svg" noMargin priority width={100} height={45} />,
		value: "azure"
	}, {
		icon: <img src="/img/logos/digital-ocean.svg" noMargin priority width={100} height={70} />,
		value: "do"
	}
	]}
	defaultLang="aws"
>
<CodeExample lang={"aws"}>

```bash
nitric deploy:aws
```

</CodeExample>
<CodeExample lang={"gcp"}>

```bash
nitric deploy:gcp
```

</CodeExample>
<CodeExample lang={"azure"}>

```bash
nitric deploy:azure
```

</CodeExample>
<CodeExample lang={"do"}>

```bash
nitric deploy:do
```

</CodeExample>
</CodeExamples>
