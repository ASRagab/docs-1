---
title: Secret Examples
---

### Encryption Data Keys

This example uses the Secrets API to store a data encryption key. This key is used to encrypt and decrypt PII data records (Personally Identifying Information).
The encryption key's secret name and secret version are stored with the PII record so that the data key can be retrieved from the Secrets API at some later point to decrypt the PII record.

Using this strategy individual records can have their own data encryption key which limits PII data exposure if an individual key is compromised.

<CodeExamples 
	languages={[
	{
		label: "Node",
		value: "node"
	},
	{
		label: "Python",
		value: "python"
	},
	{
		label: "Java",
		value: "java"
	},
	{
		label: "Go",
		value: "go"
	}
	]}
	defaultLang="node"
>
<CodeExample lang="node">

```typescript
import { secrets } from '@nitric/sdk';

const sec = secrets();

// Store a new AES-256 secret data 'encryption.key'
const dataKey = ...
await sec.secret("encryption.key").put(dataKey);

// Sometime later lookup latest version of 'encryption.key' and use this to
// encrypt a private record. Note we store the secret key name and version
// with the record so we can use this later to decrypt the record.
const value = await sec.secret("encryption.key")
  .latest()
  .access();

const dataKey = value.asBytes();

// Here we encrypt the PII data with encryption data key
const encryptedData = ...

const record = new PiiRecord({
  data: encryptedData,
  keyName: value.secretVersion.secret.name,
  keyVersion: value.secretVersion.version,
});

// Retrieve a customer PII record
const custRecord = ...

var custKey = (await sec.secret(custRecord.getKeyName())
  .version(custRecord.getKeyVersion())
  .access()).asBytes();

// Use the encryption key to decrypt the records PII data
```

</CodeExample>
<CodeExample lang="python">

```python
from nitric.api import Secrets

secrets = Secrets()

# Store a new AES-256 secret data 'encryption.key'
data_key = ...
secrets.secret("encryption.key").put(data_key)

# Sometime later lookup latest version of 'encryption.key' and use this to
# encrypt a private record. note we store the secret key name and version
# with the record so we can use this later to decrypt the record.
secret = await secrets.secret("encryption.key").latest().access()

dataKey = secret.as_bytes()

# Here we encrypt the PII data with encryption data key
encrypted_data = ...

record = PIIRecord()
record.set_encrypted_data(encrypted_data)
record.set_key_name(secret.version.secret.name)
record.set_key_version(secret.version.id)

# Retrieve a customer PII record
cust_record = ...
cust_key = await (secrets.secret(cust_record.get_key_name())
									.version(cust_record.get_key_version)
									.access())
cust_key = cust_key.as_bytes()

```

</CodeExample>
<CodeExample lang="java">

```java
import io.nitric.api.secret.Secrets;
import io.nitric.api.secret.SecretValue;
import com.example.entity.PiiRecord;


// Store a new AES-256 secret data 'encryption.key'
byte[] dataKey = ...
Secrets.secret("encryption.key").put(dataKey);

// Sometime later lookup latest version of 'encryption.key' and use this to
// encrypt a private record. Note we store the secret key name and version
// with the record so we can use this later to decrypt the record.
SecretValue value = Secrets.secret("encryption.key")
  .latest()
  .access();

byte[] dataKey = value.get();

// Here we encrypt the PII data with encryption data key
byte[] encryptedData = ...

var record = new PiiRecord();
record.setEncryptedData(encryptedData);
record.setKeyName(value.getSecretVersion().getSecret().getName());
record.setKeyVersion(value.getSecretVersion().getVersion());

// Retrieve a customer PII record
PiiRecord custRecord = ...

byte[] custKey = Secrets.secret(custRecord.getKeyName())
  .version(custRecord.getKeyVersion())
  .access()
  .get();

// Use the encryption key to decrypt the records PII data
```

</CodeExample>
<CodeExample lang="go">

```go
import (
    "github.com/nitrictech/go-sdk/api/secrets"
)

ss, err := secrets.New()

if err != nil {
  // handle error
}

// Store a new AES-256 secret data 'encryption.key'
dataKey := ...
_, err := secrets.Secret("encryption.key").Put(dataKey);

if err != nil {
  // handle error
}

// Sometime later lookup latest version of 'encryption.key' and use this to
// encrypt a private record. Note we store the secret key name and version
// with the record so we can use this later to decrypt the record.
value, err := secrets.Secret("encryption.key")
  .Latest()
  .Access();

if err != nil {
  // handle error
}

dataKey := value.Value;

// Here we encrypt the PII data with encryption data key
encryptedData := ...

record := PiiRecord{
  EncryptedData: encryptedData,
  KeyName:       value.SecretVersion.Secret.Name,
  KeyVersion:    value.SecretVersion.Version,
}

// Retrieve a customer PII record
custRecord := ...

value, err := secrets.Secret(custRecord.KeyName)
    .Version(custRecord.KeyVersion)
    .Access();

if err != nil {
	// handle error
}

custKey := value.AsBytes()

// Use the encryption key to decrypt the records PII data
```

</CodeExample>

</CodeExamples>
